<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <!-- Page shell keeps navigation on the left and main content on the right. -->
  <div class="app-shell">
    <!-- Sidebar mirrors the reference: compact brand block, grouped links, and profile footer. -->
    <aside class="sidebar-nav" aria-label="Primary">
      <!-- Sidebar header keeps product identity visible above grouped links. -->
      <div class="sidebar-brand">
        <h1 class="site-title"><img class="site-logo" src="https://imagedelivery.net/WWB_1xpr0hQZ8HyAj4j9Mg/92e7e1f1-0166-44df-cfa5-5e92ca2dad00/thumb" alt="Notpla logo" /> <span>Formulation Tracker</span></h1>
        <span class="app-version">{{ request.app.state.settings.app_version }}</span>
      </div>

      <!-- Group 1: ingredient workflows stay expanded by default for quick daily access. -->
      <details class="nav-group" open>
        <summary><span>Ingredients</span></summary>
        <div class="nav-group-items">
          <a href="/ingredients">Ingredient SKUs</a>
          <a href="/batches">Ingredient Batches</a>
        </div>
      </details>

      <!-- Group 2: formulation workflows are grouped under a single collapsible heading. -->
      <details class="nav-group" open>
        <summary><span>Formulation</span></summary>
        <div class="nav-group-items">
          <a href="/sets">Formulation Sets</a>
          <a href="/dry_weights">Dry Weights</a>
          <a href="/batch_selection">Batch Selection</a>
        </div>
      </details>

      <!-- Group 3: mixing workflows remain grouped to match production process order. -->
      <details class="nav-group" open>
        <summary><span>Mixing</span></summary>
        <div class="nav-group-items">
          <a href="/location_codes">Machine</a>
          <a href="/compounding_how">How</a>
          <a href="/pellet_bags">Pellet Bags</a>
        </div>
      </details>

      <!-- Group 4: placeholders keep roadmap pages visible without enabling broken routes. -->
      <details class="nav-group" open>
        <summary><span>Conversion 1 Film roll / coated board</span></summary>
        <div class="nav-group-items">
          <span class="nav-placeholder">Context</span>
          <span class="nav-placeholder">How</span>
          <span class="nav-placeholder">Output</span>
        </div>
      </details>

      <!-- Group 5: system tools stay separated from production workflow navigation. -->
      <details class="nav-group" open>
        <summary><span>System</span></summary>
        <div class="nav-group-items">
          <a href="/utilities">Utilities</a>
        </div>
      </details>

      <!-- Footer profile card anchors the sidebar similarly to the design reference. -->
      <div class="sidebar-user-card" aria-label="Signed in user">
        <div>
          <strong>{{ request.state.actor if request.state.actor else "Unknown user" }}</strong>
          <small>Formulation team</small>
        </div>
        <span class="sidebar-user-icon" aria-hidden="true">â†ª</span>
      </div>
    </aside>

    <!-- Content region keeps route templates unchanged while old top nav is removed. -->
    <div class="content-shell">
      <!-- Minimal sticky top bar only repeats the current page title for context. -->
      <header class="content-header">
        <h2 class="content-title">{{ title }}</h2>
      </header>
      <!-- Main content block for page-specific template sections. -->
      <main>
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>
  <script src="/static/app.js"></script>
</body>
</html>
